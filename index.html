<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roleta de Pr√™mios</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Nunito:wght@700;800;900&display=swap');
    
    .wheel-wrapper {
      position: relative;
      width: 380px;
      height: 380px;
    }
    
    .wheel-canvas {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      animation: rotate-wheel 8s linear infinite;
      pointer-events: none;
    }
    
    @keyframes rotate-wheel {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .center-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: #1a1a1a;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5), inset 0 2px 5px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 4px solid #333;
      z-index: 100;
      pointer-events: auto;
    }
    
    .center-circle:hover {
      transform: translate(-50%, -50%) scale(1.05);
      box-shadow: 0 6px 30px rgba(0,0,0,0.4), inset 0 2px 5px rgba(255,255,255,0.5);
    }
    
    .center-circle:active {
      transform: translate(-50%, -50%) scale(0.98);
    }
    
    .arrow-pointer {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 25px solid transparent;
      border-right: 25px solid transparent;
      border-top: 40px solid #ff3366;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
      z-index: 5;
    }
    
    .arrow-pointer::after {
      content: '';
      position: absolute;
      top: -36px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 18px solid transparent;
      border-right: 18px solid transparent;
      border-top: 30px solid #ff6b9d;
    }
    
    .decoration-ring {
      position: absolute;
      top: -15px;
      left: -15px;
      right: -15px;
      bottom: -15px;
      border-radius: 50%;
      border: 10px solid #8B4513;
      box-shadow: 0 0 0 3px #D2691E, inset 0 0 20px rgba(0,0,0,0.2);
    }
    
    .light-dots {
      position: absolute;
      top: -25px;
      left: -25px;
      right: -25px;
      bottom: -25px;
      border-radius: 50%;
    }
    
    .light-dot {
      position: absolute;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #ffd700;
      box-shadow: 0 0 15px #ffd700;
      animation: twinkle 1.5s ease-in-out infinite;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(0.8); }
    }
    
    .result-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.3s;
    }
    
    .result-overlay.active {
      display: flex;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .result-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 50px 40px;
      border-radius: 30px;
      text-align: center;
      max-width: 90%;
      width: 500px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    @keyframes popIn {
      0% { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .validation-code {
      background: rgba(255,255,255,0.2);
      padding: 20px;
      border-radius: 15px;
      margin: 20px 0;
      border: 2px dashed rgba(255,255,255,0.5);
    }
    
    .code-display {
      font-family: 'Courier New', monospace;
      font-size: 32px;
      font-weight: bold;
      color: #FFD700;
      letter-spacing: 3px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      margin: 10px 0;
    }
    
    .date-time {
      color: rgba(255,255,255,0.9);
      font-size: 14px;
      margin-top: 10px;
    }
    
    .whatsapp-btn {
      background: #25D366;
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: bold;
      font-size: 18px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s;
      margin-top: 15px;
    }
    
    .whatsapp-btn:hover {
      background: #1faa52;
      transform: scale(1.05);
    }
    
    .confetti-piece {
      position: fixed;
      width: 10px;
      height: 10px;
      pointer-events: none;
    }
    
    @keyframes confetti-drop {
      to {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full flex flex-col items-center justify-center p-6 overflow-auto" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);">
   <div class="text-center mb-10 max-w-2xl">
    <h1 id="mainTitle" class="text-5xl md:text-6xl font-black text-white mb-4" style="font-family: 'Bangers', cursive; text-shadow: 3px 3px 6px rgba(0,0,0,0.3);">Obrigado pela avalia√ß√£o!</h1>
    <p id="subtitle" class="text-xl md:text-2xl text-white font-bold" style="font-family: 'Nunito', sans-serif; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">Gire a roleta e ganhe um brinde na pr√≥xima vez que vier na Toca</p>
   </div>
   <div class="wheel-wrapper">
    <div class="light-dots" id="lightDots"></div>
    <div class="decoration-ring"></div>
    <div class="arrow-pointer"></div>
    <canvas id="wheelCanvas" class="wheel-canvas" width="380" height="380"></canvas>
    <div class="center-circle" id="spinBtn">
     <svg width="80" height="80" viewbox="0 0 80 80"><text x="40" y="35" font-family="Bangers, cursive" font-size="20" fill="#FFD700" text-anchor="middle" font-weight="bold">
       TOCA
      </text> <text x="40" y="50" font-family="Arial, sans-serif" font-size="9" fill="#DC143C" text-anchor="middle" font-weight="bold">
       MUSIC BAR
      </text>
     </svg>
    </div>
   </div>
   <p class="mt-10 text-white text-lg font-semibold" style="font-family: 'Nunito', sans-serif; text-shadow: 1px 1px 3px rgba(0,0,0,0.3);">‚ú® Clique no centro para girar! ‚ú®</p>
  </div>
  <div id="resultOverlay" class="result-overlay">
   <div class="result-box">
    <div id="resultIcon" class="text-7xl mb-5">
     üéâ
    </div>
    <h2 id="resultTitle" class="text-4xl font-black text-white mb-3" style="font-family: 'Bangers', cursive;">Parab√©ns!</h2>
    <p id="resultMessage" class="text-2xl text-white font-bold mb-4" style="font-family: 'Nunito', sans-serif;"></p>
    <div id="validationSection" class="validation-code" style="display: none;">
     <p class="text-white font-bold mb-2" style="font-size: 18px;">C√≥digo de Valida√ß√£o:</p>
     <div id="validationCode" class="code-display"></div>
     <div id="dateTime" class="date-time"></div>
    </div><button id="whatsappBtn" class="whatsapp-btn" style="display: none;">
     <svg width="24" height="24" viewbox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
     </svg> Enviar para WhatsApp </button> <button id="closeBtn" class="bg-white text-purple-600 px-10 py-4 rounded-full text-xl font-black hover:bg-yellow-300 transition-all transform hover:scale-105 mt-4" style="font-family: 'Nunito', sans-serif;"> FECHAR </button>
   </div>
  </div>
  <script>
    const defaultConfig = {
      background_color: '#667eea',
      secondary_color: '#764ba2',
      text_color: '#ffffff',
      button_color: '#ffd700',
      accent_color: '#8B4513',
      font_family: 'Bangers',
      font_size: 16,
      main_title: 'Obrigado pela avalia√ß√£o!',
      subtitle: 'Gire a roleta e ganhe um brinde na pr√≥xima vez que vier na Toca',
      whatsapp_number: '5532999444547',
      prize_1: 'N√£o foi dessa vez',
      prize_2: 'Caipirinha de lim√£o',
      prize_3: 'Caipivodka',
      prize_4: '10% de desconto',
      prize_5: 'Madonna',
      prize_6: 'Molas e um Chopp'
    };
    
    const prizes = [
      { key: 'prize_1', weight: 60, color: '#000000', textColor: '#FFFFFF', emoji: 'üò¢' },
      { key: 'prize_2', weight: 20, color: '#FFFFFF', textColor: '#000000', emoji: 'üçã' },
      { key: 'prize_3', weight: 8, color: '#800020', textColor: '#FFFFFF', emoji: 'üç∏' },
      { key: 'prize_4', weight: 6, color: '#DC143C', textColor: '#FFFFFF', emoji: 'üí∞' },
      { key: 'prize_5', weight: 4, color: '#FFD700', textColor: '#000000', emoji: 'üéµ' },
      { key: 'prize_6', weight: 2, color: '#FFEB3B', textColor: '#000000', emoji: 'üçª' }
    ];
    
    let currentConfig = { ...defaultConfig };
    let spinning = false;
    let currentRotation = 0;
    let currentValidationCode = '';
    let currentDateTime = '';
    let currentPrize = '';
    
    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    const spinBtn = document.getElementById('spinBtn');
    const resultOverlay = document.getElementById('resultOverlay');
    const closeBtn = document.getElementById('closeBtn');
    const whatsappBtn = document.getElementById('whatsappBtn');
    
    function generateValidationCode() {
      const timestamp = Date.now().toString(36).toUpperCase();
      const random = Math.random().toString(36).substr(2, 4).toUpperCase();
      return `${timestamp}-${random}`;
    }
    
    function formatDateTime() {
      const now = new Date();
      const date = now.toLocaleDateString('pt-BR', { 
        day: '2-digit', 
        month: '2-digit', 
        year: 'numeric' 
      });
      const time = now.toLocaleTimeString('pt-BR', { 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit'
      });
      return { date, time, full: `${date} √†s ${time}` };
    }
    
    function drawWheel() {
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = canvas.width / 2;
      const sliceAngle = (Math.PI * 2) / prizes.length;
      
      prizes.forEach((prize, i) => {
        const startAngle = i * sliceAngle - Math.PI / 2;
        const endAngle = startAngle + sliceAngle;
        
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.lineTo(centerX, centerY);
        ctx.fillStyle = prize.color;
        ctx.fill();
        
        ctx.strokeStyle = '#FFFFFF';
        ctx.lineWidth = 3;
        ctx.stroke();
        
        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(startAngle + sliceAngle / 2);
        ctx.textAlign = 'center';
        ctx.fillStyle = prize.textColor;
        ctx.font = 'bold 20px Arial';
        ctx.fillText(prize.emoji, radius * 0.65, -10);
        ctx.font = 'bold 16px Arial';
        const text = currentConfig[prize.key];
        const maxWidth = 80;
        const words = text.split(' ');
        let line = '';
        let y = 10;
        
        words.forEach((word, index) => {
          const testLine = line + word + ' ';
          const metrics = ctx.measureText(testLine);
          if (metrics.width > maxWidth && index > 0) {
            ctx.fillText(line, radius * 0.65, y);
            line = word + ' ';
            y += 18;
          } else {
            line = testLine;
          }
        });
        ctx.fillText(line, radius * 0.65, y);
        
        ctx.restore();
      });
    }
    
    function createLights() {
      const container = document.getElementById('lightDots');
      container.innerHTML = '';
      const numLights = 24;
      
      for (let i = 0; i < numLights; i++) {
        const dot = document.createElement('div');
        dot.className = 'light-dot';
        const angle = (i / numLights) * Math.PI * 2;
        const radius = 50;
        dot.style.left = `calc(50% + ${Math.cos(angle) * radius}% - 7px)`;
        dot.style.top = `calc(50% + ${Math.sin(angle) * radius}% - 7px)`;
        dot.style.animationDelay = `${i * 0.1}s`;
        container.appendChild(dot);
      }
    }
    
    function selectPrize() {
      const totalWeight = prizes.reduce((sum, p) => sum + p.weight, 0);
      const random = Math.random() * totalWeight;
    let acumulado = 0;
      
     for (let i = 0; i < prizes.length; i++) {
  acumulado += prizes[i].weight;
  if (random <= acumulado) {
    return i;
  }
}
      return 0;
    }
    
    function spin() {
      if (spinning) return;
      spinning = true;
      
      const prizeIndex = selectPrize();
      
      canvas.style.animation = 'none';
      
      setTimeout(() => {
        const sliceAngle = 360 / prizes.length;
const prizeAngle = prizeIndex * sliceAngle + sliceAngle / 2;
const spins = 8 + Math.floor(Math.random() * 4);
const targetAngle = 360 - prizeAngle + (sliceAngle / 2);
const finalRotation = (spins * 360) + targetAngle;

        canvas.style.transition = 'transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
        canvas.style.transform = `rotate(${finalRotation}deg)`;
        
        setTimeout(() => {
          showResult(prizeIndex);
          spinning = false;
          
          canvas.style.transition = 'none';
          canvas.style.transform = 'rotate(0deg)';
          
          setTimeout(() => {
            canvas.style.animation = 'rotate-wheel 8s linear infinite';
          }, 100);
        }, 5000);
      }, 50);
    }
    
    function showResult(index) {
      const prize = prizes[index];
      const isWinner = index !== 0;
      
      currentPrize = currentConfig[prize.key];
      currentValidationCode = generateValidationCode();
      const dateTimeInfo = formatDateTime();
      currentDateTime = dateTimeInfo.full;
      
      document.getElementById('resultIcon').textContent = isWinner ? 'üéâ' : 'üòî';
      document.getElementById('resultTitle').textContent = isWinner ? 'PARAB√âNS!' : 'QUE PENA!';
      document.getElementById('resultMessage').textContent = isWinner 
        ? `Voc√™ ganhou: ${currentPrize}!`
        : currentPrize;
      
      if (isWinner) {
        document.getElementById('validationSection').style.display = 'block';
        document.getElementById('validationCode').textContent = currentValidationCode;
        document.getElementById('dateTime').textContent = currentDateTime;
        document.getElementById('whatsappBtn').style.display = 'inline-flex';
      } else {
        document.getElementById('validationSection').style.display = 'none';
        document.getElementById('whatsappBtn').style.display = 'none';
      }
      
      resultOverlay.classList.add('active');
      
      if (isWinner) {
        launchConfetti();
      }
    }
    
    function sendToWhatsApp() {
      const phone = currentConfig.whatsapp_number || defaultConfig.whatsapp_number;
      const message = `üéâ *PR√äMIO GANHO - TOCA MUSIC BAR* üéâ\n\n` +
                     `üéÅ Pr√™mio: *${currentPrize}*\n\n` +
                     `üîê C√≥digo de Valida√ß√£o:\n*${currentValidationCode}*\n\n` +
                     `üìÖ Data/Hora: ${currentDateTime}\n\n` +
                     `Apresente este c√≥digo no estabelecimento para resgatar seu pr√™mio!`;
      
      const encodedMessage = encodeURIComponent(message);
      const whatsappUrl = `https://wa.me/${phone}?text=${encodedMessage}`;
      
      window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
    }
    
    function launchConfetti() {
      const colors = ['#FFD700', '#FF6B9D', '#4ECDC4', '#95E1D3', '#F38181', '#AA96DA'];
      
      for (let i = 0; i < 80; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti-piece';
          confetti.style.left = `${Math.random() * 100}%`;
          confetti.style.top = '-10px';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.width = `${5 + Math.random() * 10}px`;
          confetti.style.height = confetti.style.width;
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
          confetti.style.animation = `confetti-drop ${2 + Math.random() * 2}s linear forwards`;
          confetti.style.animationDelay = `${Math.random() * 0.5}s`;
          document.body.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 5000);
        }, i * 30);
      }
    }
    
    async function onConfigChange(newConfig) {
      currentConfig = { ...defaultConfig, ...newConfig };
      
      const mainTitle = document.getElementById('mainTitle');
      const subtitle = document.getElementById('subtitle');
      const app = document.getElementById('app');
      
      const customFont = currentConfig.font_family || defaultConfig.font_family;
      const baseSize = currentConfig.font_size || defaultConfig.font_size;
      
      mainTitle.style.fontFamily = `${customFont}, cursive`;
      subtitle.style.fontFamily = `${customFont}, sans-serif`;
      mainTitle.style.fontSize = `${baseSize * 3}px`;
      subtitle.style.fontSize = `${baseSize * 1.25}px`;
      
      mainTitle.textContent = currentConfig.main_title;
      subtitle.textContent = currentConfig.subtitle;
      
      mainTitle.style.color = currentConfig.text_color;
      subtitle.style.color = currentConfig.text_color;
      
      app.style.background = `linear-gradient(135deg, ${currentConfig.background_color} 0%, ${currentConfig.secondary_color} 50%, #f093fb 100%)`;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawWheel();
    }
    
    spinBtn.addEventListener('click', spin);
    closeBtn.addEventListener('click', () => {
      resultOverlay.classList.remove('active');
    });
    
    whatsappBtn.addEventListener('click', sendToWhatsApp);
    
    resultOverlay.addEventListener('click', (e) => {
      if (e.target === resultOverlay) {
        resultOverlay.classList.remove('active');
      }
    });
    
    drawWheel();
    createLights();
    
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (cfg) => ({
          recolorables: [
            {
              get: () => cfg.background_color || defaultConfig.background_color,
              set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
            },
            {
              get: () => cfg.secondary_color || defaultConfig.secondary_color,
              set: (v) => { cfg.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); }
            },
            {
              get: () => cfg.text_color || defaultConfig.text_color,
              set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
            },
            {
              get: () => cfg.button_color || defaultConfig.button_color,
              set: (v) => { cfg.button_color = v; window.elementSdk.setConfig({ button_color: v }); }
            },
            {
              get: () => cfg.accent_color || defaultConfig.accent_color,
              set: (v) => { cfg.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => cfg.font_family || defaultConfig.font_family,
            set: (v) => { cfg.font_family = v; window.elementSdk.setConfig({ font_family: v }); }
          },
          fontSizeable: {
            get: () => cfg.font_size || defaultConfig.font_size,
            set: (v) => { cfg.font_size = v; window.elementSdk.setConfig({ font_size: v }); }
          }
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['main_title', cfg.main_title || defaultConfig.main_title],
          ['subtitle', cfg.subtitle || defaultConfig.subtitle],
          ['whatsapp_number', cfg.whatsapp_number || defaultConfig.whatsapp_number],
          ['prize_1', cfg.prize_1 || defaultConfig.prize_1],
          ['prize_2', cfg.prize_2 || defaultConfig.prize_2],
          ['prize_3', cfg.prize_3 || defaultConfig.prize_3],
          ['prize_4', cfg.prize_4 || defaultConfig.prize_4],
          ['prize_5', cfg.prize_5 || defaultConfig.prize_5],
          ['prize_6', cfg.prize_6 || defaultConfig.prize_6]
        ])
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c4d29ee45871b25',t:'MTc2OTU2ODQzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>